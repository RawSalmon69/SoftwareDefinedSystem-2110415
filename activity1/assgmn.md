2110415 Software-defined Systems
Activity: Docker
จากตัวอย่างในชั้นเรียนที่ท า multi-container application ซึ่งประกอบด้วย container node-exporter, Prometheus
และ Grafana ให้นิสิตเพิ่ม container
1) Apache web server
2) apache-exporter ซึ่งทาหน้าที่เก็บข้อมูลจาก Apache web server
การตั้งค่า Apache Web server เพื่อให้สร้างหน้า server status
ให้สร้างไฟล์ชื่อ status.conf
<IfModule mod_status.c>
# Allow server status reports generated by mod_status,
# with the URL of http://servername/server-status
# Uncomment and change the "192.0.2.0/24" to allow access from other hosts.
<Location /server-status>
SetHandler server-status
<RequireAll>
Require all granted
</RequireAll>
</Location>
# Keep track of extended status information for each request
ExtendedStatus On
# Determine if mod_status displays the first 63 characters of a request or
# the last 63, assuming the request itself is greater than 63 chars.
# Default: Off
#SeeRequestTail On
<IfModule mod_proxy.c>
# Show Proxy LoadBalancer status in mod_status
ProxyStatus On
</IfModule>
</IfModule>
สร้าง container โดยใช้คาสั่งดังนี้
docker run -d --name apache -p 8080:80 -v /path/to/status.conf:/etc/apache2/mods-enabled/status.conf
ubuntu/apache2
เมื่อเปิดหน้าเว็บที่ http://localhost:8080/server-status/?auto จะได้ผลลัพธ์ดังตัวอย่าง
การสร้าง container ของ Apache exporter ให้รันคาสั่งดังตัวอย่าง
docker run -d -p 9117:9117 --name apache-exporter bitnami/apache-exporter --
scrape_uri="http:localhost:8080/server-status?auto"
เมื่อไปที่ localhost:9117/metrics จะได้ผลลัพธ์ดังตัวอย่าง
จากนั้นให้นิสิต
- แก้ไขไฟล์ prometheus.yml เพื่อเพิ่ม apache และ apache exporter เข้าไปในระบบ
- สร้างกราฟจาก apache-exporter ใน Grafana ด้วย (เลือก metrics เอง)
- รันโปรแกรมทดสอบ (จะแจ้งรายละเอียดเพิ่มเติมภายหลัง)
สิ่งที่ต้องส่งใน myCourseVilleได้แก่
1. ไฟล์ prometheus.yml
2. ภาพ capture หน้าจอ พร้อมค าอธิบายสั้นๆ ประกอบแต่ละภาพ ของ
2.1 การรันคาสั่งและผลลัพธ์ที่ได้ของ
2.1.1 คาสั่งที่สร้าง network
2.1.2 คาสั่งที่สร้าง persistent storage
2.1.3 คาสั่งที่รัน container แต่ละตัว
2.2 หน้าจอ Grafana ที่มีกราฟจาก node-exporter และ apache-exporter พร้อมค าอธิบายสั้นๆ เกี่ยวกับ metrics ที่เลือกใช้